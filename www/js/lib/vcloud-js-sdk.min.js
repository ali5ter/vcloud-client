/*
 VMware Cloud Director JavaScript SDK Library

 Copyright (c) 2012 VMware, Inc. All rights reserved.

*/
var vmware="undefined"==typeof vmware||!vmware?{}:vmware;vmware.events="undefined"==typeof vmware.events||!vmware.events?{}:vmware.events;var global,global2,imageData;vmware.cloudVersion={V1_0:"1.0",V1_5:"1.5",V5_1:"5.1"};var connectivity=1;
vmware.events.cloud={INITIALIZATION_COMPLETE:"event.cloud.initialization.complete",LOGIN:"event.cloud.login",TASK_START:"event.cloud.task.start.",TASK_COMPLETE:"event.cloud.task.complete.",REFRESH_COMPLETE:"event.cloud.refresh.complete",REFRESH_SINGLE:"event.cloud.refresh.single",TEMPLATE_REFRESH:"event.cloud.template.refresh",SEARCH_COMPLETE:"event.cloud.search.complete",PROGRESS_UPDATE:"event.cloud.progress.update",NEW_TICKET:"event.cloud.ticket.new",ERROR:"event.cloud.error",TEMPLATE_FILLED:"event.cloud.template.filled."};
vmware.cloud=function(a,f){var e="";vmware.rest.get(a.concat("versions")).done(function(b){$(b).find("VersionInfo").each(function(){$(this).find("Version").text()==f&&(e=$(this).find("LoginUrl").text(),d.trigger(vmware.events.cloud.INITIALIZATION_COMPLETE))});""==e&&d.trigger(vmware.events.cloud.ERROR,localizer.get("SYSTEM_NOT_SUPPORTED"))}).error(function(){d.trigger(vmware.events.cloud.ERROR,localizer.get("SYSTEM_NOT_SUPPORTED"))});var i={vapps:{},vms:{}},j={vapps:{},vms:{}},h=[],n={},g={},d=vmware.eventManager({});
d.base=a;d.login=function(b,k,o){$.base64.encode(b+"@"+o+":"+k);vmware.rest.addHeader("Authorization","Basic "+$.base64.encode(b+"@"+o+":"+k));vmware.rest.addHeader("Accept","application/*+xml;version=5.1");vmware.rest.post(e).done(function(b){b={success:!0,data:$.parseXML(b.xml?b.xml:(new XMLSerializer).serializeToString(b))};d.user=new z(b.data.childNodes[0].getAttribute("user"),b.data.childNodes[0].getAttribute("org"));d.begin();d.trigger(vmware.events.cloud.LOGIN,b)}).fail(function(b){d.trigger(vmware.events.cloud.LOGIN,
{success:!1,data:b.statusText})})};d.confirmLoggedIn=function(){vmware.rest.addHeader("Accept","application/*+xml;version=5.1");vmware.rest.get(a.concat("session")).done(function(b){b={success:!0,confirm:!0,data:$.parseXML(b.xml?b.xml:(new XMLSerializer).serializeToString(b))};d.user=new z(b.data.childNodes[0].getAttribute("user"),b.data.childNodes[0].getAttribute("org"));d.begin();d.trigger(vmware.events.cloud.LOGIN,b)}).fail(function(b){d.trigger(vmware.events.cloud.LOGIN,{success:!1,confirm:!0,
data:b.statusText})})};d.fetchURL=function(b,k,o,g,a){var e=function(b){null!=g&&g($.parseXML(b.xml?b.xml:(new XMLSerializer).serializeToString(b)))};vmware.rest.removeAllHeaders();o?vmware.rest.addHeader("Accept",o):vmware.rest.addHeader("Accept","application/*+xml;version=5.1");"GET"==k||null==k?vmware.rest.get(b).done(function(b){connectivity=1;e(b)}).fail(function(b){connectivity&&(console.warn("Fetch error: "+b.statusText),connectivity=0,d.trigger(vmware.events.cloud.ERROR,localizer.get("LOST_CONNECTIVITY")))}):
"POST"==k?vmware.rest.post(b).done(function(b){e(b)}).fail(function(b){console.warn("Post error: "+b.statusText)}):"DELETE"==k?vmware.rest.del(b).done(function(b){e(b)}).fail(function(b){console.warn("Delete error: "+b.statusText)}):"SOAP"==k&&(vmware.soap.addHeader("Content-Type","text/xml; charset=utf-8"),vmware.soap.addHeader("SOAPAction","urn:vim25/4.1"),vmware.soap.post(b,a).done(function(b){e(b)}).fail(function(b,d){console.warn("SOAP error: "+d)}))};var l=function(b){if(!1==p.comissioning)if(setTimeout(function(){p.comissioning=
!1},3E4),p.comissioning=!0,b=b.getElementsByTagName("VAppRecord"),0!=b.length){j.vapps={};j.vms={};for(var k,o=0;o<b.length;o++)if("VAppRecord"==b[o].nodeName){k=new vApp(d);for(var g=0;g<b[o].attributes.length;g++)k.setAttr(b[o].attributes[g].name,b[o].attributes[g].value);d.fetchURL(b[o].getAttribute("href"),null,null,A(k))}}else d.trigger(vmware.events.cloud.REFRESH_COMPLETE,!1),p.comissioning=!1},p=this,r=this.comissioning=!1,s=0,q=0,B=function(b){0!=q&&(d.trigger(vmware.events.cloud.PROGRESS_UPDATE,
d.percentageDoneUpdate()),s++,s==q&&(q=s=0,!1==r&&(i=j),j={vapps:[],vms:[]},p.comissioning=!1,!0==r?d.trigger(vmware.events.cloud.REFRESH_SINGLE,{vapp:b}):d.trigger(vmware.events.cloud.REFRESH_COMPLETE,!0),r=!1))},F=function(b){q=0;for(var b=b.getElementsByTagName("VMRecord"),k=0;k<b.length;k++)"UNRESOLVED"!=b[k].getAttribute("status")&&"false"==b[k].getAttribute("isVAppTemplate")&&q++;d.fetchURL(a.concat("query?type=vApp&format=records&pageSize=1024"),"GET",null,l)},A=function(b){return function(k){var g=
namespacex="";null!=k.childNodes[0].getAttribute("xmlns:vcloud")&&(g="vcloud",namespacex=g+":");g=""==g?function(b){return k.getElementsByTagName(b)}:function(b){return k.getElementsByTagNameNS(k.childNodes[0].getAttribute("xmlns:vcloud"),b)};if(k.childNodes[0].nodeName==namespacex+"VApp"){var a=g("Description")[0].childNodes;a&&a.length&&b.setAttr("description",a[0].nodeValue);for(a=0;a<k.childNodes[0].attributes.length;a++)b.setAttr(k.childNodes[0].attributes[a].name,k.childNodes[0].attributes[a].value);
(a=g("DateCreated")[0].childNodes)&&a.length&&b.setAttr("creationDate",a[0].nodeValue);(a=g("Owner")[0].childNodes)&&a.length&&b.setAttr("ownerName",a[1].getAttribute("name"));r?i.vapps[b.getID()]=b:j.vapps[b.getID()]=b;for(var a=g("Link"),e=0;e<a.length;e++)k.childNodes[0].nodeName==a[e].parentNode.nodeName&&b.addLink(a[e].getAttribute("rel"),a[e].getAttribute("href"));b.setAttr("searchTerm","name:"+b.getName()+"owner:"+b.getOwnerName()+"status:"+b.getStatusMessage()+"description:"+b.getDescription());
b.setAttr("searchTerm",b.getAttr("searchTerm").toLowerCase());b.children=[];var h=g("Vm");r&&(q=h.length);for(e=0;e<h.length;e++){getTag=function(b){return h[e].getElementsByTagName(b)};for(var f=new vM(d),a=0;a<h[e].attributes.length;a++)f.setAttr(h[e].attributes[a].name,h[e].attributes[a].value);null!=getTag("IpAddress")[0]&&f.setAttr("ip",getTag("IpAddress")[0].childNodes[0].nodeValue);null!=k.getElementsByTagNameNS("http://schemas.dmtf.org/ovf/envelope/1","Description")[0]&&f.setAttr("guestOS",
h[e].getElementsByTagNameNS("http://schemas.dmtf.org/ovf/envelope/1","Description")[0].childNodes[0].nodeValue);null!=g("NetworkConnection")[0]&&f.setAttr("network",getTag("NetworkConnection")[0].getAttribute("network"));(a=getTag("Description")[0].childNodes)&&a.length&&f.setAttr("description",a[0].nodeValue);for(var a=g("Link"),l=0;l<a.length;l++)h[e].nodeName==a[l].parentNode.nodeName&&f.addLink(a[l].getAttribute("rel"),a[l].getAttribute("href"));f.updateConsoleThumbnail();b.children.push(f.getID());
r?(i.vms[f.getID()]=f,B(b)):(j.vms[f.getID()]=f,B())}}}},u=function(b,g){if(null!=d.getVM(b))d.fetchURL(d.getVM(b).links[g],"POST",null,d.taskManager.newTask);else if(null!=d.getVApp(b)){d.taskManager.addFakeTask(d.getVApp(b).getHref());if("power:powerOff"==g)return vmware.rest.addHeader("Content-Type","application/vnd.vmware.vcloud.undeployVAppParams+xml"),xml='<?xml version="1.0" encoding="UTF-8"?>                    <UndeployVAppParams                       xmlns="http://www.vmware.com/vcloud/v1.5">                       <UndeployPowerAction>powerOff</UndeployPowerAction>                    </UndeployVAppParams>',
vmware.rest.post(d.getVApp(b).links.undeploy,xml).done(function(b){d.taskManager.newTask($.parseXML(b.xml?b.xml:(new XMLSerializer).serializeToString(b)))}),!0;"remove"==g?d.fetchURL(d.getVApp(b).links[g],"DELETE",null,d.taskManager.newTask):d.fetchURL(d.getVApp(b).links[g],"POST",null,d.taskManager.newTask)}else{var e;e=a.concat("vApp/"+b.split(":")[b.split(":").length-2]+"-"+b.split(":")[b.split(":").length-1]);e="power"==g.split(":")[0]?e+"/power/action/"+g.split(":")[1]:e+"/action/"+g;d.fetchURL(e,
"POST",null,d.taskManager.newTask)}},w={ownerName:"owner",memoryAllocationMB:"memory",catalogName:"catalog",storageKB:"storage",cpuAllocationMhz:"cpu"},x=function(b,a,g){return function(e){var f=e.getElementsByTagName("VAppTemplateRecord");if(0!=f.length)for(var i,j=0;j<f.length;j++){i=new Template;for(var l=0;l<f[j].attributes.length;l++)i.setAttr(w[f[j].attributes[l].name]?w[f[j].attributes[l].name]:f[j].attributes[l].name,f[j].attributes[l].value),i.setAttr("searchTerm",i.getAttr("searchTerm")+
(w[f[j].attributes[l].name]?w[f[j].attributes[l].name]:f[j].attributes[l].name)+":"+f[j].attributes[l].value);h[(b-1)*a+j]=i}if(g){e=e.getElementsByTagName("Link");for(j=0;j<e.length;j++)if("nextPage"==e[j].getAttribute("rel")){d.fetchURL(e[j].getAttribute("href"),"GET",null,x(b+1,128,!0));return}y=!0}d.trigger(vmware.events.cloud.TEMPLATE_REFRESH,h)}};d.user=null;var z=function(b,d){return{getName:function(){return b},getOrg:function(){return d}}};d.getUserName=function(){return this.user.getName()};
d.getUserOrg=function(){return this.user.getOrg()};d.fleshOutTemplate=function(b){null==b.getAttr("childNames")?d.fetchURL(b.getHref(),"GET",null,C(b)):cloud.trigger(vmware.events.cloud.TEMPLATE_FILLED+b.getHref(),b)};d.fleshOutMultiple=function(b){for(var a=b.length,g=0,e=0;e<a;e++)templ=b[e],cloud.once(vmware.events.cloud.TEMPLATE_FILLED+templ.getHref(),function(){g++;g==a&&cloud.trigger(vmware.events.cloud.TEMPLATE_FILLED)}),d.fetchURL(templ.getHref(),"GET",null,C(templ))};var C=function(b){return function(d){null!=
d.getElementsByTagName("Description")[0].childNodes[0]&&b.setAttr("description",d.getElementsByTagName("Description")[0].childNodes[0].nodeValue);null!=d.getElementsByTagName("NetworkConfig")[0]&&b.setAttr("network",d.getElementsByTagName("NetworkConfig")[0].getAttribute("networkName"));b.setAttr("childNames",[]);for(var a=0;a<d.getElementsByTagName("Vm").length;a++)b.setAttr("childNames",b.getAttr("childNames").concat(d.getElementsByTagName("Vm")[a].getAttribute("name")));cloud.trigger(vmware.events.cloud.TEMPLATE_FILLED+
b.getHref(),b)}};d.getAllTemplates=function(){d.fetchURL(a.concat("query?type=vAppTemplate&format=records&page=1&pageSize=128"),"GET",null,x(1,128,!0))};var D=function(b,g,e){d.fetchURL(a.concat("query?type="+b+"&format=records"),"GET",null,G(g,e))},G=function(b,d){return function(a){for(var a=a.getElementsByTagName(b),g=0;g<a.length;g++)-1!=a[g].getAttribute("linkType")&&(d[a[g].getAttribute("name")]=a[g].getAttribute("href"))}};d.metrics=function(){m={totalStorage:0,totalMemory:0,totalRunning:0,
totalStopped:0,totalSuspended:0,totalError:0,tasksPerHour:0};temp=d.getVApps(d.SORTBY.DATE);for(var b=0;b<temp.length;b++){switch(temp[b].getStatus()){case temp[b].STATUS_OFF:m.totalStopped++;break;case temp[b].STATUS_SUSPENDED:m.totalSuspended++;break;case temp[b].STATUS_ERROR:m.totalError++;break;default:m.totalRunning++}m.totalStorage+=parseInt(temp[b].getAttr("storageKB"))/1E3;m.totalMemory+=parseInt(temp[b].getAttr("memoryAllocationMB"))}m.tasksPerHour=Math.ceil(d.taskManager.tasksPerHour());
return m};var y=!1,E=function(b){return function(){global=b;y=!0;for(var a=[],g,e=0;e<h.length;e++)if(g=!0,h[e]){for(var f in b)if(b[f].match("-")){if(terms=b[f].split("-"),!(""==terms[0].replace(" ","").replace(",","")||parseInt(terms[0].replace(" ","").replace(",",""))<=parseInt(h[e].getAttr(f)))||!(""==terms[1].replace(" ","").replace(",","")||parseInt(terms[1].replace(" ","").replace(",",""))>=parseInt(h[e].getAttr(f)))){g=!1;break}}else for(var i=0;i<b[f].split(" ").length;i++)if(""!=b[f].split(" ")[i]&&
(null==h[e].getAttr(f)||null==h[e].getAttr(f).toLowerCase().match(b[f].split(" ")[i].toLowerCase()))){g=!1;break}g&&a.push(h[e])}d.trigger(vmware.events.cloud.SEARCH_COMPLETE,a)}};d.getNetworks=function(){names=[];for(var b in n)names.push(b);return names};d.getVdcList=function(){names=[];for(var b in g)names.push(b);return names};d.editVApp=function(b,a,g){a='<?xml version="1.0" encoding="UTF-8" standalone="no"?>                        <vcloud:VApp                            xmlns:vcloud="http://www.vmware.com/vcloud/v1.5"                            name="'+
(a||d.getVApp(b).getName())+'">                            <vcloud:Description>'+(g||d.getVApp(b).getDescription())+"</vcloud:Description>                    </vcloud:VApp>";vmware.rest.addHeader("Content-Type","application/vnd.vmware.vcloud.vApp+xml");vmware.rest.put(d.getVApp(b).getHref(),a).done(function(b){d.taskManager.newTask($.parseXML(b.xml?b.xml:(new XMLSerializer).serializeToString(b)))})};d.instantiateVApp=function(b,a,e,f,i,h){templateObj=d.getTemplateFromHref(i);if(!g[e]||!templateObj)return!1;
d.once(vmware.events.cloud.TEMPLATE_FILLED+i,function(j){networkName=j.eventData.getNetwork();f=n[f]?f:n[0];j=instantTempParams(b,a,networkName,n[f],i,h);vmware.rest.addHeader("Content-Type","application/vnd.vmware.vcloud.instantiateVAppTemplateParams+xml");vmware.rest.post(g[e]+"/action/instantiateVAppTemplate",j).done(function(b){d.once(vmware.events.cloud.TASK_START,d.updateModels);d.taskManager.newTask($.parseXML(b.xml?b.xml:(new XMLSerializer).serializeToString(b)))})});d.fleshOutTemplate(templateObj);
return!0};d.searchCatalogFaceted=function(b){y?E(b)():(d.once(vmware.events.cloud.TEMPLATE_REFRESH,E(b)),d.getAllTemplates())};d.searchCatalog=function(b){d.searchCatalogFaceted({searchTerm:b})};d.taskHistory=function(){return d.taskManager.taskLog()};d.updateModels=function(){d.fetchURL(a.concat("query?type=vm&format=records&pageSize=1024"),"GET",null,F)};d.begin=function(){d.metadata=new Metadata(a);d.taskManager=new TaskManager(d);d.register(vmware.events.cloud.TASK_COMPLETE,d.updateSingle);D("orgVdcNetwork",
"OrgVdcNetworkRecord",n);D("orgVdc","OrgVdcRecord",g);d.taskManager.autoRefresh=function(b){d.fetchURL(a.concat("query?type=task&filter=(status==running)"),"GET",null,b)};d.fetchURL(a.concat("query?type=task&pageSize=15&sortDesc=startDate"),"GET",null,d.taskManager.loadTasksLog);d.updateModels();d.getAllTemplates();d.once(vmware.events.cloud.TEMPLATE_REFRESH,function(){d.metadata.register(d.metadata.filterTemplates("downloads"),function(b){for(t in b)d.getTemplateFromHref(t).setAttr("downloads",b[t])})})};
d.updateSingle=function(b){b=b.eventData.data;r=!0;d.fetchURL(b.attr.ownerHref,"GET",null,A(d.getVAppFromHref(b.attr.ownerHref)||new vApp(d),!0))};d.updateCatalog=function(b,g){for(var e=(b-1)*g;e<b*g;e++)if(null==h[e])return d.fetchURL(a.concat("query?type=vAppTemplate&format=records&page="+b+"&pageSize="+g),"GET",null,x(b,g,!1));d.trigger(vmware.events.cloud.TEMPLATE_REFRESH,h)};d.getCatalog=function(){return h};d.getVMStatus=function(b){for(var a=d.taskManager.inProgress(),g=0;g<a.length;g++)if(null!=
b.getID().match(a[g]))return b.STATUS_WORKING;return b.getStatus()};d.percentageDoneUpdate=function(){return 0!=q?100*s/q:0};d.getVApps=function(b){list=[];for(var a in i.vapps)list.push(i.vapps[a]);if(null!=b){switch(b){case d.SORTBY.NAME:sorter=function(b,d){return b.getName()>d.getName()};break;case d.SORTBY.DATE:sorter=function(b,d){return b.getCreationDate()>d.getCreationDate()}}return list.sort(sorter)}return list};d.SORTBY={NAME:0,DATE:1};d.getVMs=function(){list=[];for(var b in i.vms)list.push(i.vms[b]);
return list};d.getVM=function(b){return i.vms[b]};d.getVApp=function(b){return i.vapps[b]};d.getVObject=function(b){return d.getVApp(b)||d.getVM(b)};d.getVAppFromHref=function(b){for(var d in i.vapps)if(i.vapps[d].getAttr("href")==b)return i.vapps[d]};d.getTemplateFromHref=function(b){for(var d in h)if(h[d].getAttr("href")==b)return h[d]};d.powerOff=function(b){u(b,"power:powerOff")};d.powerOn=function(b){u(b,"power:powerOn")};d.suspend=function(b){u(b,"power:suspend")};d.deleteVApp=function(b){u(b,
"remove")};d.displayConsole=function(b,d){cloud.once(vmware.events.cloud.NEW_TICKET,function(){});d.getConsoleTicket()};d.saveCache=function(){for(var b={vapps:[]},a=d.getVApps(),g=0;g<a.length;g++)b.vapps.push(a[g].save());b.vms=[];a=d.getVMs();for(g=0;g<a.length;g++)b.vms.push(a[g].save());b.catalog=[];a=d.getCatalog();for(g=0;g<a.length;g++)b.catalog.push(a[g].save());b.tasks=d.taskManager.saveLog();return JSON.stringify(b)};d.loadCache=function(b){b=JSON.parse(b);i={vapps:{},vms:{}};h=[];for(var a,
g=0;g<b.vapps.length;g++)a=new vApp(d),a.load(b.vapps[g]),i.vapps[a.getID()]=a;for(g=0;g<b.vms.length;g++)a=new vM(d),a.load(b.vms[g]),i.vms[a.getID()]=a;for(g=0;g<b.catalog.length;g++)a=new Template,a.load(b.catalog[g]),h.push(a);d.taskManager.loadLog(b.tasks);d.trigger(vmware.events.cloud.REFRESH_COMPLETE)};return d};vmware="undefined"==typeof vmware||!vmware?{}:vmware;vmware.events.log=[];
vmware.eventManager=function(a){var f={};a.register=function(a,i,j){vmware.events.log.push("Registering "+String(i).split(" ")[1]+" with "+a);i={method:i,handlerData:j};f.hasOwnProperty(a)?f[a].push(i):f[a]=[i]};a.unregister=function(a,i){vmware.events.log.push("Unregistering "+String(i).split(" ")[1]+" with "+a);for(var j=f[a].length-1;0<=j;j--)f[a][j].method===i&&f[a].splice(j,1)};a.trigger=function(a,i){if(f.hasOwnProperty(a)){var j=f[a];vmware.events.log.push("Triggering "+a+", "+j.length+" registered.");
for(var h=0;h<j.length;h+=1){var n=j[h];n.method.apply(this,[{key:a,handlerData:n.handlerData,eventData:i}])}}};a.once=function(e,f,j){var h=function(j){f(j);a.unregister(e,h)};a.register(e,h,j)};return a};var instantTempParams=function(a,f,e,i,j,h){return"<?xml version='1.0' encoding='UTF-8'?>    <InstantiateVAppTemplateParams       xmlns='http://www.vmware.com/vcloud/v1.5'       name='"+a+"'       deploy='"+(null==h?!1:h)+"'       powerOn='"+(null==h?!1:h)+"'       xmlns:xsi='http://www.w3.org/2001/XMLSchema-instance'       xmlns:ovf='http://schemas.dmtf.org/ovf/envelope/1'>       <Description>"+f+"</Description>       <InstantiationParams>"+(i?"          <NetworkConfigSection>             <ovf:Info>Configuration parameters for logical networks             </ovf:Info>             <NetworkConfig                networkName='"+
e+"'>                <Configuration>                   <ParentNetwork                      href='"+i+"' />                   <FenceMode>bridged</FenceMode>                </Configuration>             </NetworkConfig>          </NetworkConfigSection>":"")+"</InstantiationParams>       <Source          href='"+j+"' />    </InstantiateVAppTemplateParams>"};function Metadata(a){var f=0,e={},i={register:function(a,d){e[a]=d}},j=function(a,d,f){vmware.rest.get(a).done(function(a){a=f($.parseXML(a.xml?a.xml:(new XMLSerializer).serializeToString(a)));if(e[d])e[d](a);delete e[d]})},h=function(a){for(var d={},a=a.getElementsByTagName("MetadataEntry"),e=0;e<a.length;e++)d[a[e].getElementsByTagName("Key")[0].childNodes[0].nodeValue]=a[e].getElementsByTagName("Value")[0].childNodes[0].nodeValue;return d},n=function(a){for(var d={},a=0!=a.getElementsByTagName("VAppRecord").length?
a.getElementsByTagName("VAppRecord"):a.getElementsByTagName("VAppTemplateRecord"),e=0;e<a.length;e++)d[a[e].getAttribute("href")]=a[e].getElementsByTagName("Value")[0].childNodes[0].nodeValue;return d};i.get=function(a){var d=f++;j(a.getHref()+"/metadata",d,h);return d};i.filterTemplates=function(g){var d=f++;j(a.concat("query?type=vAppTemplate&fields=metadata:"+g+"&filter=metadata:"+g+"=ge=NUMBER:0"),d,n);return d};i.filterVApps=function(g){var d=f++;j(a.concat("query?type=vApp&fields=metadata:"+
g+"&filter=metadata:"+g+"=ge=NUMBER:0"),d,n);return d};i.set=function(a,d,i){var h=f++,a=a.getHref()+"/metadata",d='<Metadata            xmlns="http://www.vmware.com/vcloud/v1.5"            xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"            type="application/vnd.vmware.vcloud.metadata+xml">                <MetadataEntry                    type="application/vnd.vmware.vcloud.metadata.value+xml">                        <Key>'+d+'</Key>                        <TypedValue                            xsi:type="Metadata'+
(typeof i).substring(0,1).toUpperCase()+(typeof i).substr(1)+'Value">                                <Value>'+i+"</Value>                        </TypedValue>                </MetadataEntry>        </Metadata>";vmware.rest.addHeader("Content-Type","application/vnd.vmware.vcloud.metadata+xml");vmware.rest.post(a,d).done(function(){if(e[h])e[h](void 0);delete e[h]});return h};return i};function vObj(){this.cloud=null;this.zfavorite=!1;this.STATUS_ON=0;this.STATUS_OFF=1;this.STATUS_WORKING=2;this.STATUS_SUSPENDED=3;this.STATUS_ERROR=4;this.STATUS_PARTIAL=5;this.addChild=function(a){this.children.push(a)};this.setAttr=function(a,f){this.attr[a]=f};this.getAttr=function(a){return this.attr[a]};this.addLink=function(a,f){this.links[a]=f};this.getID=function(){return this.attr.id};this.getName=function(){return this.attr.name};this.getHref=function(){return this.attr.href};this.save=
function(){return{attr:this.attr,links:this.links,children:this.children,favorite:this.zfavorite}};this.load=function(a){this.attr=a.attr||this.attr;this.links=a.links||this.links;this.children=a.children||this.children;this.zfavorite=a.favorite||this.zfavorite};this.favorite=function(a){null!=a&&(this.zfavorite=a);return this.zfavorite};this.getDescription=function(){return this.attr.description};this.getStatusMessage=function(){switch(this.getStatus()){case this.STATUS_ON:return localizer.get("STATUS_ON");
case this.STATUS_OFF:return localizer.get("STATUS_OFF");case this.STATUS_ERROR:return localizer.get("STATUS_ERROR");case this.STATUS_WORKING:return localizer.get("STATUS_WORKING");case this.STATUS_PARTIAL:return localizer.get("STATUS_PARTIAL");case this.STATUS_SUSPENDED:return localizer.get("STATUS_SUSPENDED")}};this.isVM=function(){return null!=this.attr.guestOS};this.canPowerOn=function(){return-1!=[this.STATUS_OFF,this.STATUS_PARTIAL,this.STATUS_SUSPENDED].indexOf(this.getStatus())&&null!=this.links["power:powerOn"]};
this.canPowerOff=function(){return-1!=[this.STATUS_ON,this.STATUS_PARTIAL,this.STATUS_SUSPENDED].indexOf(this.getStatus())&&null!=this.links["power:powerOff"]};this.canSuspend=function(){return this.getStatus()==this.STATUS_ON&&null!=this.links["power:suspend"]};this.powerOn=function(){return this.cloud.powerOn(this.getID())};this.powerOff=function(){return this.cloud.powerOff(this.getID())};this.suspend=function(){return this.cloud.suspend(this.getID())}}vApp.prototype=new vObj;
vApp.prototype.constructor=vApp;
function vApp(a){this.cloud=a;this.children=[];this.attr={};this.links={};this.searchTerm=function(){return this.attr.searchTerm};this.getNumberOfVMs=function(){return this.children.length};this.getOwnerName=function(){return this.attr.ownerName};this.getCreationDate=function(){return this.attr.creationDate};this.getChildren=function(){return this.children.map(a.getVM)};this.canDelete=function(){return null!=this.links.remove};this.getVDCName=function(){return this.attr.vdcName};this.edit=function(f,
e){return a.editVApp(this.getID(),f,e)};this.getStatus=function(){for(var a=this.cloud.taskManager.inProgress(),e=0;e<a.length;e++)if(-1!=this.getID().indexOf(a[e]))return this.STATUS_WORKING;for(var a=0,i=this.children.length,j=this.getChildren(),e=0;e<j.length;e++)switch(stat=j[e].getStatus(),stat){case this.STATUS_ON:a++;break;case this.STATUS_SUSPENDED:a+=3.1415;break;case this.STATUS_ERROR:return this.STATUS_ERROR}e=3.1415*i;switch(a){case 0:return this.STATUS_OFF;case i:return this.STATUS_ON;
case e:return this.STATUS_SUSPENDED;default:return this.STATUS_PARTIAL}}}vM.prototype=new vObj;vM.prototype.constructor=vM;
function vM(a){this.cloud=a;this.children=[];this.attr={};this.links={};this.consoleThumbnail="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAEAAAAAwCAIAAAAuKetIAAAAH0lEQVRoge3BAQEAAACCIP+vbkhAAQAAAAAAAAAALwYkMAABjuvAZwAAAABJRU5ErkJggg==";this.getStatus=function(){return 4==this.attr.status?this.STATUS_ON:8==this.attr.status?this.STATUS_OFF:3==this.attr.status?this.STATUS_SUSPENDED:this.STATUS_ERROR};this.getGuestOS=function(){return this.attr.guestOS};this.getNetwork=function(){return this.attr.network};
this.getIP=function(){return this.attr.ip};this.updateConsoleThumbnail=function(){var a=this,e=this.links["screen:thumbnail"];"undefined"!=e&&(vmware.rest.removeAllHeaders(),vmware.rest.addHeader("Accept","application/*+xml;version=5.1"),vmware.rest.get(e).fail(function(e){4==e.readyState&&200==e.status&&(e=e.responseText,0!=e&&(a.thumbnail=e))}))};this.getConsoleTicket=function(){var a=this.links["screen:acquireTicket"];if(void 0==a)return console.log("Unable to open console. The VM should be powered-on."),
!1;this.cloud.fetchURL(a,"POST","",function(a){var a=a.getElementsByTagName("ScreenTicket")[0].childNodes[0].nodeValue,f;f=(f=/mks:\/\/([^\/]*)\/([^\?]*)\?ticket=(.*)/.exec(a))?{host:f[1],moid:f[2],ticket:unescape(f[3])}:!1;console.log("vCD ScreenTicket: "+a);this.cloud.fetchURL("https://"+f.host+":9443/sdk","SOAP","*/*",function(){console.log("Host ticket fetched")},'<CloneSession xmlns="urn:vim25"><_this type="SessionManager">SessionManager</_this><cloneTicket xsi:type="xsd:string">'+f.ticket+"</cloneTicket></CloneSession>")})}}
function Template(){this.attr={searchTerm:""};this.xml="";this.setAttr=function(a,f){this.attr[a]=f};this.getAttr=function(a){return this.attr[a]};this.save=function(){return{attr:this.attr}};this.load=function(a){this.attr=a.attr||this.attr};this.getHref=function(){return this.getAttr("href")};this.getName=function(){return this.getAttr("name")};this.getDescription=function(){return this.getAttr("description")};this.getDownloads=function(){return this.getAttr("downloads")};this.getNetwork=function(){return this.getAttr("network")};
this.getChildren=function(){return this.getAttr("childNames")};this.getOwnerName=function(){return this.getAttr("owner")};this.getCatalogName=function(){return this.getAttr("catalog")};this.getCPUMhz=function(){return this.getAttr("cpu")};this.getMemoryMB=function(){return this.getAttr("memory")};this.getStorageKB=function(){return this.getAttr("storage")}};vmware="undefined"==typeof vmware||!vmware?{}:vmware;
vmware.rest=function(){var a={},f={},e=function(e,f,i){return $.ajax(f,{type:e,headers:a,dataType:i||"xml"})},i=function(e,f,i,g){return $.ajax(f,{type:e,data:i,headers:a,dataType:g||"xml"})};f.dataType="xml";f.addHeader=function(e,f){a[e]=f};f.hasHeader=function(e){return null!=a[e]};f.removeHeader=function(e){delete a[e]};f.removeAllHeaders=function(){a={}};f.get=function(a){return e("GET",a)};f.postGetJSON=function(a,f){return f?i("POST",a,f,"json"):e("POST",a,"json")};f.post=function(a,f){return f?
i("POST",a,f):e("POST",a)};f.put=function(a,f){return f?i("PUT",a,f):e("PUT",a)};f.del=function(a){return e("DELETE",a)};return f}();vmware="undefined"==typeof vmware||!vmware?{}:vmware;
vmware.soap=function(){var a={};return{dataType:"xml",addHeader:function(f,e){a[f]=e},hasHeader:function(f){return null!=a[f]},removeHeader:function(f){delete a[f]},removeAllHeaders:function(){a={}},post:function(f,e){return $.ajax(f,{type:"POST",data:'<?xml version="1.0" encoding="UTF-8"?><soapenv:Envelope xmlns:soapenc="http://schemas.xmlsoap.org/soap/encoding/" xmlns:soapenv="http://schemas.xmlsoap.org/soap/envelope/" xmlns:xsd="http:/www.w3.org/2001/XMLSchema" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"><soapenv:Body>'+e+
"</soapenv:Body></soapenv:Envelope>",headers:a,dataType:"xml",cache:!1})}}}();function TaskManager(a){var f,e={},i={},j=function(){this.attr={}};j.prototype.addAttr=function(a,d){this.attr[a]=d};var h={autoRefresh:null,update:function(){clearTimeout(f);var g=!1;for(key in e)a.fetchURL(e[key].attr.href,"GET",null,h.refreshTask),g=!0;h.autoRefresh&&h.autoRefresh(h.loadTasks);f=g?setTimeout("cloud.taskManager.update();",5E3):setTimeout("cloud.taskManager.update();",1E4)},loadTasks:function(a){h.loadTasksTo(e)(a)},loadTasksLog:function(a){h.loadTasksTo(i)(a)},loadTasksTo:function(a){return function(d){var e,
f;for(f=0;f<d.getElementsByTagName("TaskRecord").length;f++){e=new j;for(var i=d.getElementsByTagName("TaskRecord")[f],h=0;h<i.attributes.length;h++)e.addAttr(i.attributes[h].name,i.attributes[h].value);a[e.attr.href]=e}}},newTask:function(e){h.refreshTask(e);a.trigger(vmware.events.cloud.TASK_START)},refreshTask:function(g){for(var d=new j,f=g.getElementsByTagName("Task")[0],p=0;p<f.attributes.length;p++)d.addAttr(f.attributes[p].name,f.attributes[p].value);0!=g.getElementsByTagName("Link").length&&
d.addAttr("cancel",g.getElementsByTagName("Link")[0].getAttribute("href"));d.addAttr("ownerHref",g.getElementsByTagName("Owner")[0].getAttribute("href"));d.addAttr("user",g.getElementsByTagName("User")[0].getAttribute("name"));0!=g.getElementsByTagName("Progress").length&&d.addAttr("progress",g.getElementsByTagName("Progress")[0].childNodes[0].data);null==i[d.attr.href]&&("success"==d.attr.status?(f={success:!0,data:d},i[d.attr.href]=d,-1!=d.attr.ownerHref.match("vapp")&&h.addFakeTask(d.attr.ownerHref),
delete e[d.attr.href],null==d.attr.progress&&null==d.attr.name.match("elete")&&null==d.attr.operationName.match("elete")?a.trigger(vmware.events.cloud.TASK_COMPLETE,f):a.updateModels()):"error"==d.attr.status?(f={success:!1,data:d},message=g.getElementsByTagName("Error")[0].getAttribute("message")||(g.getElementsByTagName("Details")[0].childNodes[0]?g.getElementsByTagName("Details")[0].childNodes[0].data:null),d.addAttr("error",message),i[d.attr.href]=d,delete e[d.attr.href],a.trigger(vmware.events.cloud.TASK_COMPLETE,
f)):e[d.attr.href]=d)},numberOfTasks:function(){return h.inProgress().length},saveLog:function(){return i},loadLog:function(a){i=a},details:function(a){return task=null==e[a]?i[a]:e[a]},taskLog:function(){for(var a=[],d=[i,e],f={},h=0;h<d.length;h++)for(key in d[h])f[key]=d[h][key];for(key in f)a.push([null!=f[key].attr.ownerName?f[key].attr.ownerName:f[key].attr.user,n("task"!=f[key].attr.name?f[key].attr.name:f[key].attr.operationName),null!=f[key].attr.startDate?f[key].attr.startDate:f[key].attr.startTime,
f[key].attr.status,key]);return a.sort(function(a,d){return a[2]>d[2]?-1:a[2]<d[2]?1:0})}},n=function(a){var d={poweron:localizer.get("TASK_POWERING_ON"),poweroff:localizer.get("TASK_POWERING_OFF"),acquirescreen:localizer.get("TASK_CONSOLE"),suspend:localizer.get("TASK_SUSPEND"),instantiate:localizer.get("TASK_CREATE_VAPP"),"delete":localizer.get("TASK_DELETE"),jobundeploy:localizer.get("TASK_UNDEPLOY_VAPP"),jobdeploy:localizer.get("TASK_DEPLOY_VAPP"),vappundeploy:localizer.get("TASK_UNDEPLOY_VAPP"),
vappdeploy:localizer.get("TASK_DEPLOY_VAPP"),update:localizer.get("TASK_EDIT_VAPP"),uploadovf:localizer.get("TASK_UPLOAD_OVF")},e;for(e in d)if(null!=a.toLowerCase().match(e))return d[e];return a};h.tasksPerHour=function(){hours=[];count=0;tl=h.taskLog();for(var a=0;a<tl.length;a++)newdate=new Date(tl[a][2]),(0==hours.length||36E5<hours[hours.length-1]-newdate)&&hours.push(newdate);return tl.length/hours.length};h.tasks=function(){return e};h.fakeTasks={};h.addFakeTask=function(e){h.fakeTasks[e]=
1;a.trigger(vmware.events.cloud.REFRESH_SINGLE,{vapp:a.getVAppFromHref(e),dontdeleteplease:1})};h.inProgress=function(){var a=[];for(key in e)e[key].attr.ownerHref&&a.push(e[key].attr.ownerHref.split("/")[e[key].attr.ownerHref.split("/").length-1].split("-").slice(1).join("-"));for(key in h.fakeTasks)a.push(key.split("/")[key.split("/").length-1].split("-").slice(1).join("-"));return a};h.update();a.register(vmware.events.cloud.REFRESH_COMPLETE,function(){h.fakeTasks={}});a.register(vmware.events.cloud.REFRESH_SINGLE,
function(e){null==e.eventData.dontdeleteplease&&(h.fakeTasks={},e.eventData.dontdeleteplease=1,a.trigger(vmware.events.cloud.REFRESH_SINGLE,e.eventData))});return h};localizer={lang:0,languages:{EN:0},setlang:function(a){lang=a;this[lang]||(this[lang]={});return this},add:function(a,f){this[lang][a]=f;return this},get:function(a){return this[lang]?this[lang][a]:a}};
localizer.setlang(localizer.languages.EN).add("SYSTEM_NOT_SUPPORTED","You are attempting to connect to a system no longer supported.").add("LOST_CONNECTIVITY","You seem to have lost connectivity - your changes will not be saved until connectivity is reestablished.").add("STATUS_ON","Powered On").add("STATUS_OFF","Powered Off").add("STATUS_ERROR","Error!").add("STATUS_WORKING","Working...").add("STATUS_PARTIAL","Partially On").add("STATUS_SUSPENDED","Suspended").add("TASK_POWERING_ON","Powering On").add("TASK_POWERING_OFF",
"Powering Off").add("TASK_CONSOLE","Connecting To Console").add("TASK_SUSPEND","Suspending").add("TASK_CREATE_VAPP","Creating vApp").add("TASK_DELETE","Deleting").add("TASK_UNDEPLOY_VM","Undeploying VM").add("TASK_DEPLOY_VM","Deploying VM").add("TASK_UNDEPLOY_VAPP","Undeploying vApp").add("TASK_DEPLOY_VAPP","Deploying vApp").add("TASK_EDIT_VAPP","Editing vApp").add("TASK_UPLOAD_OVF","Uploading OVF");
